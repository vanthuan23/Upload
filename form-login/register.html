<!DOCTYPE html>
<html lang="en">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../model/User.js"></script>
</head>
<body>
<section class="vh-100" style="background-color: #eee;">
    <div class="container h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Sign up</p>
                                <div class="d-flex flex-row align-items-center mb-4">
                                    <svg style="color: orange;width: 25px;height: 25px"
                                         xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                         fill="currentColor" class="bi bi-person-fill mb-4" viewBox="0 1 16 16">
                                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                    </svg>
                                    <div class="form-outline flex-fill mb-0">
                                        <input oninput="validate()" type="text" id="name" class="form-control"/>
                                        <label id="validate_name" class="form-label">Your Name</label>
                                    </div>
                                </div>
                                <div class="d-flex flex-row align-items-center mb-4">
                                    <svg style="color: orange;width: 25px;height: 25px"
                                         xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                         fill="currentColor" class="bi bi-person-bounding-box mb-4"
                                         viewBox="0 0 16 16">
                                        <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5z"/>
                                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                    </svg>
                                    <div class="form-outline flex-fill mb-0">
                                        <input oninput="validate()" type="text" id="userName" class="form-control"/>
                                        <label id="validate_username" class="form-label">UserName</label>
                                    </div>
                                </div>

                                <div class="d-flex flex-row align-items-center mb-4">
                                    <svg style="color: orange;width: 25px;height: 25px"
                                         xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                         fill="currentColor" class="bi bi-envelope-at-fill mb-4"
                                         viewBox="0 0 16 16">
                                        <path d="M2 2A2 2 0 0 0 .05 3.555L8 8.414l7.95-4.859A2 2 0 0 0 14 2H2Zm-2 9.8V4.698l5.803 3.546L0 11.801Zm6.761-2.97-6.57 4.026A2 2 0 0 0 2 14h6.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.606-3.446l-.367-.225L8 9.586l-1.239-.757ZM16 9.671V4.697l-5.803 3.546.338.208A4.482 4.482 0 0 1 12.5 8c1.414 0 2.675.652 3.5 1.671Z"/>
                                        <path d="M15.834 12.244c0 1.168-.577 2.025-1.587 2.025-.503 0-1.002-.228-1.12-.648h-.043c-.118.416-.543.643-1.015.643-.77 0-1.259-.542-1.259-1.434v-.529c0-.844.481-1.4 1.26-1.4.585 0 .87.333.953.63h.03v-.568h.905v2.19c0 .272.18.42.411.42.315 0 .639-.415.639-1.39v-.118c0-1.277-.95-2.326-2.484-2.326h-.04c-1.582 0-2.64 1.067-2.64 2.724v.157c0 1.867 1.237 2.654 2.57 2.654h.045c.507 0 .935-.07 1.18-.18v.731c-.219.1-.643.175-1.237.175h-.044C10.438 16 9 14.82 9 12.646v-.214C9 10.36 10.421 9 12.485 9h.035c2.12 0 3.314 1.43 3.314 3.034v.21Zm-4.04.21v.227c0 .586.227.8.581.8.31 0 .564-.17.564-.743v-.367c0-.516-.275-.708-.572-.708-.346 0-.573.245-.573.791Z"/>
                                    </svg>
                                    <div class="form-outline flex-fill mb-0">
                                        <input oninput="validate()" type="email" id="email" class="form-control"/>
                                        <label id="validate_email" class="form-label">Your Email</label>
                                    </div>
                                </div>

                                <div class="d-flex flex-row align-items-center mb-4">
                                    <svg style="color: orange;width: 25px;height: 25px"
                                         xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                         fill="currentColor" class="bi bi-eye-fill mb-4" viewBox="0 0 16 16">
                                        <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                                        <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                                    </svg>
                                    <div class="form-outline flex-fill mb-0">
                                        <input oninput="validate()" type="password" id="password" class="form-control"/>
                                        <label id="validate_password" class="form-label">Password</label>
                                    </div>
                                </div>

                                <div class="d-flex flex-row align-items-center mb-4">
                                    <svg style="color: orange;width: 25px;height: 25px"
                                         xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                         fill="currentColor" class="bi bi-eye-slash-fill mb-4" viewBox="0 0 16 16">
                                        <path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.089z"/>
                                        <path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z"/>
                                    </svg>
                                    <div class="form-outline flex-fill mb-0">
                                        <input oninput="validate()" type="password" id="repeat your password"
                                               class="form-control"/>
                                        <label id="validate_repeat your password" class="form-label">Repeat your
                                            password</label>
                                    </div>
                                </div>

                                <div class="form-check d-flex justify-content-center mb-5">
                                    <input class="form-check-input me-2" type="checkbox" value=""
                                           id="form2Example3c"/>
                                    <label class="form-check-label">
                                        I agree all statements in <a href="#!">Terms of service</a>
                                    </label>
                                </div>

                                <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                    <button  disabled id="btn-register" onclick="register()" type="button"
                                            class="btn btn-primary btn-lg" ><a href="login.html"></a>
                                        Register
                                    </button>
                                </div>


                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">

                                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp"
                                     class="img-fluid" alt="Sample image">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
<script>
    let name;
    let username;
    let email;
    let password;
    let rePassword;
    let checkValidate = false;
    let checkUsernameExisted = false;
    let lisUser = JSON.parse(localStorage.getItem("userList"));
    let id;
    console.log("lisuser-->", lisUser)
    if (lisUser === null) {
        lisUser = [];
        id = 1;
    } else {
        id = lisUser[lisUser.length - 1].id + 1;
    }

    function validate() {
        name = document.getElementById('name').value;
        username = document.getElementById('userName').value;
        email = document.getElementById('email').value;
        password = document.getElementById('password').value;
        rePassword = document.getElementById('repeat your password').value;
        if (name.trim() === '') {
            document.getElementById('validate_name').innerHTML = '<label style="color: red">The name is required!</label>'
            checkValidate = false;
            btnRegister();
            return;
        } else {
            document.getElementById('validate_name').innerHTML = `<label style="color: green">Your Name: ${name} </label>`
            checkValidate = true;
        }
        if (username.trim() === '') {
            console.log('username tren if --->', username)
            document.getElementById('validate_username').innerHTML = '<label style="color: red">The username is required!</label>'
            checkValidate = false;
            btnRegister();
            return;
        } else {
            checkExistedByUsername();
            if (checkUsernameExisted) {
                checkValidate = false;
                document.getElementById('validate_username').innerHTML = '<label style="color: red">The username is existed! Please try again!</label>'
                btnRegister();
                return;
            } else {
                console.log('ussername vao day khong?', username)
                document.getElementById('validate_username').innerHTML = `<label style="color: green">Your username: ${username} </label>`
                checkValidate = true;
            }
        }
        if (email.trim() === '') {
            document.getElementById('validate_email').innerHTML = '<label style="color: red">The username is required!</label>'
            checkValidate = false;
            btnRegister();
            return;
        } else {
            if (!validateEmail(email)) {
                document.getElementById('validate_email').innerHTML = '<label style="color: red">The email invalid!</label>'
                checkValidate = false;
                btnRegister();
                return;
            } else {
                if (checkExistedByEmail(email)) {
                    document.getElementById('validate_email').innerHTML = '<label style="color: red">The email existed!</label>'
                    checkValidate = false;
                    btnRegister();
                    return;
                } else {
                    document.getElementById('validate_email').innerHTML = `<label style="color: green">Your email: ${email} </label>`
                    checkValidate = true;
                }
            }
        }
        if (password.trim() === "") {
            document.getElementById("validate_password").innerHTML = '<label style="color: red">password is required!</label>'
            checkValidate = false;
            btnRegister();
            return;
        } else {
            document.getElementById("validate_password").innerHTML = "";
            checkValidate = true;
        }
        if (rePassword != password) {
            document.getElementById("validate_repeat your password").innerHTML = '<label style="color: red">repeat password does not match</label>'
            checkValidate = false;
            btnRegister();
            return;
        } else {
            document.getElementById("validate_repeat your password").innerHTML = '<label style="color: blue">repeat password successfully! </label>'
            checkValidate = true;
        }
        btnRegister()
    }

    function btnRegister() {
        if (checkValidate) {
            document.getElementById("btn-register").disabled = false;
            console.log("vapBTN TRUE")
        } else {
            document.getElementById("btn-register").disabled = true;
        }
    }

    function register() {
        if (checkValidate) {
            let user = new User(id, name, username, email, password);
            lisUser.push(user);
            console.log("lisUser--->", lisUser);
            localStorage.setItem("userList", JSON.stringify(lisUser));
            location.href = "login.html";
        }
    }

    function checkExistedByUsername() {
        for (let i = 0; i < lisUser.length; i++) {
            if (username === lisUser[i].username) {
                checkUsernameExisted = true;
                break
            } else {
                checkUsernameExisted = false;
            }
        }
    }

    function checkExistedByEmail(email) {
        for (let i = 0; i < lisUser.length; i++) {
            if (email === lisUser[i].email) {
                return true;
            }
        }
        return false;
    }

    function validateEmail(mail) {
        if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) {
            return (true)
        }
        return (false)
    }
</script>
</html>